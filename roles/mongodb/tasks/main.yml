---
- name: Gather RedHat based systems' specific variables
  include_vars: "redhat.yml"
  when:
    ansible_distribution == "RedHat" or
    ansible_distribution == "CentOS" or
    ansible_distribution == "Amazon"

- name: Gather Debian based systems' specific variables
  include_vars: "debian.yml"
  when:
    ansible_distribution == "Debian" or
    ansible_distribution == "Ubuntu"

- name: Add mongodb public key to verify package
  apt_key:
    url: https://www.mongodb.org/static/pgp/server-4.4.asc
    state: present
  when:
    ansible_distribution == "Ubuntu" or
    ansible_distribution == "Debian"

- name: "Copy {{ package_def_file }}"
  template:
    src: "../files/{{ package_def_file }}"
    dest: "{{ package_def_folder }}/{{ package_def_file }}"

- name: Install MongoDB
  package:
    name: mongodb-org
    state: present
    update_cache: yes

- name: Enable MongoDB
  service:
    name: mongod
    state: started
    enabled: yes

- name: Inject bind address into /etc/mongod.conf
  lineinfile:
    dest: /etc/mongod.conf
    regexp: "^  bindIp: "
    line: "  bindIp: {{ bind_address }}"

- name: Restart Redis
  service:
    name: mongod
    state: restarted
    enabled: yes
